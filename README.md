原神Vulkan适配模块

模块简介

本模块是一个基于 KernelSU 的环境配置工具，旨在为《原神》游戏提供 Vulkan 图形接口的兼容性支持。其主要功能是自动识别设备 GPU 型号，并将其正确写入游戏的配置文件中。同时，模块内置保护机制，确保配置文件不被意外修改或覆盖。

功能特性

核心功能

· 自动GPU适配：在模块安装后首次运行时，自动检测设备的 GPU 型号（如高通 Adreno、联发科 Mali、三星 Xclipse 等），并将其适配到《原神》的 Vulkan 配置文件中。
· 防修改保护：模块会持续监控关键的配置文件。如果检测到文件被游戏更新或其他程序修改，它会自动将其恢复为正确的适配版本。
· 智能兼容：支持广泛的硬件平台，包括骁龙、天玑、三星 Exynos、海思麒麟等，并能自动识别其对应的 GPU 型号。
· 系统集成：完全基于 KernelSU 的模块系统运行，不修改系统分区，所有状态均通过 KernelSU 的配置系统进行管理。

模块结构

模块文件结构如下，所有脚本均位于模块目录内：

```
yuan_shen_vulkan_support/
├── META-INF/
│   └── com/google/android/
│       ├── update-binary      # 安装脚本
│       └── updater-script     # 安装器兼容性脚本
├── module.prop                # 模块属性与信息
├── post-mount.sh              # 核心脚本：系统启动后执行检查与适配
├── service.sh                 # 服务脚本：提供定时检查功能
├── gpu_detect.sh              # 功能脚本：具体实现GPU检测与配置写入
└── README.md                  # 本文档
```

安装要求

· 必需环境：设备必须已安装并运行 KernelSU。
· 游戏：设备上需已安装《原神》游戏。
· 硬件：设备 GPU 应支持 Vulkan API 1.1以上版本推荐1.2及以上版本使用效果更佳

保护机制

· 启动时保护：每次设备启动后，模块会立即检查配置文件的完整性与正确性。
· 定时保护：模块设置了一个每日（凌晨3:00至3:10之间）运行的定时检查任务。
· 修复机制：一旦在上述检查中发现配置文件内容与模块记录的正确配置不符，将立即进行自动修复。

支持的GPU型号示例

模块能适配包括但不限于以下系列的 GPU：

高通 Adreno 系列

· Adreno (TM) 840, 830, 825
· Adreno (TM) 750, 740, 730
· Adreno (TM) 640 等

联发科 Mali 系列

· Mali-G710, G715, G720
· Mali-G925
· Mali-G1-Ultra MC12 等

三星 Xclipse 系列

· Samsung Xclipse 950, 940, 920 等

配置文件位置

模块操作和保护的配置文件位于游戏数据目录：

```
/storage/emulated/0/Android/data/com.miHoYo.Yuanshen/files/
├── vulkan_gpu_list_config.txt
└── vulkan_gpu_list_config_engine.txt
```

请勿手动修改这些文件，模块会自动管理它们。

故障排除

Q: 安装模块并重启后，游戏内没有变化？
A:首先确认《原神》游戏已安装。模块的运行和修复过程是静默的，你可以通过下文“手动检查”的方式验证模块状态。

Q: 模块检测到的 GPU 型号不准确？
A:由于设备系统信息差异，极少数情况下可能检测不准。你可以暂时禁用模块，手动编辑上述配置文件，然后重新启用模块，模块会以你手动设置的型号为准进行保护。

Q: 如何确认模块正在工作？
A:你可以使用以下命令查看日志：

```bash
logcat | grep -i “yuan.*shen.*vulkan”
```

手动检查与操作

```bash
# 查看已安装的模块列表，确认本模块存在
ksud module list

# 手动触发一次设备重启，这会执行启动时检查
reboot
```

卸载模块

1. 打开 KernelSU 管理器。
2. 在模块列表中找到“原神Vulkan适配”。
3. 点击该模块的卸载选项。
4. 根据提示重启设备以完全卸载。

技术细节

状态存储

模块利用 KernelSU 的配置系统存储关键状态，例如：

· last_check_date: 记录上次执行定时检查的日期。
· original_gpu_hash: 存储正确配置文件的哈希值，用于比对。
· gpu_model: 保存成功检测到的 GPU 型号字符串。

执行调度

· post-mount.sh：在系统启动早期、挂载完成后执行，负责主要适配与检查逻辑。
· service.sh：由 KernelSU 服务管理，用于实现每日凌晨的定时检查。在非检查时段，它会保持休眠以节省资源。

安全与兼容

· 修改配置文件后会正确设置其文件权限（644）和 SELinux 上下文。
· 所有操作均在用户数据分区完成，不影响系统分区安全性。

开发者信息

· 模块名称：原神Vulkan适配模块
· 模块ID：yuan_shen_vulkan_support
· 当前版本：v2.0
· 版本代码：20241204
· 作者：快手阿泠好困想睡觉

本模块为免费开源项目，允许在遵守开源协议的前提下进行使用和修改。

免责声明：本模块仅为技术研究和个人兴趣而开发，旨在改善特定游戏的功能兼容性。使用者应自行承担因使用本模块而可能带来的任何风险，开发者不对任何直接或间接的损失负责。请合理使用。